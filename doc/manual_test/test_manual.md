# 手動テスト項目

実際にZoteroを操作して行うテスト項目をまとめたものです。

## セットアップとプラグイン設定

### 初回設定

1. Zoteroの設定画面 > 詳細 > 一般 > プラグイン を開く
2. "Zotero S3 Sync"タブが追加されていることを確認
3. S3プロバイダーを選択（Amazon S3 / Cloudflare R2 / MinIO / Custom）
4. 各プロバイダーごとの認証情報を入力
5. "接続をテスト"ボタンを押して認証が成功することを確認
6. "設定を保存"で設定を保存

### Cloudflare R2特有設定

1. Cloudflare R2を選択
2. Cloudflare APIトークンを設定
3. カスタムドメインの設定
4. パブリック開発URL機能の有効化
5. URLタイプ選択（カスタムドメイン / r2.dev / 無効）

## 基本的なファイル操作

### 追加（自動アップロード）

1. **PDFファイルの直接追加**

   - Zoteroライブラリに直接PDFファイルをドラッグ&ドロップ
   - 自動的にS3にアップロードされることを確認
   - ローカルファイルが削除され、URLリンクに変換されることを確認
   - タイトルに "[S3]" が付加されることを確認

2. **Web論文の添付ファイル自動取得**

   - arXivのURLを追加（例: https://arxiv.org/abs/2301.00001）
   - PDFが自動的にダウンロードされ、S3にアップロードされることを確認
   - ローカルの一時ファイルが削除されることを確認

3. **DOIからの論文追加**
   - DOIを使って論文を追加（例: 10.1038/nature12373）
   - PDFが利用可能な場合、自動的にS3に保存されることを確認

### ダウンロード（手動・自動）

1. **右クリックメニューからのダウンロード**

   - S3に保存された添付ファイル（"[S3]"マーク付き）を右クリック
   - "S3からダウンロード"メニューが表示されることを確認
   - メニューをクリックしてダウンロード開始
   - プログレスバーが表示されることを確認
   - ダウンロード完了後、ローカルファイルに変換されることを確認

2. **アイテム選択でのダウンロード**

   - 複数のS3添付ファイルを選択
   - 右クリックメニューから一括ダウンロード
   - 各ファイルのプログレスが表示されることを確認
   - 成功/失敗件数が正しく表示されることを確認

3. **ファイルダブルクリックでの自動ダウンロード**
   - S3添付ファイルをダブルクリック
   - 自動的にダウンロードが開始されることを確認
   - ダウンロード完了後、関連アプリケーションでファイルが開かれることを確認

### 再アップロード

1. **ローカルファイルの再アップロード**

   - ダウンロードしたローカル添付ファイルを右クリック
   - "S3にアップロード"メニューが表示されることを確認
   - メニューをクリックしてアップロード開始
   - 重複ファイルの場合、重複検出メッセージが表示されることを確認
   - 既存ファイルを使用してアップロードが完了することを確認

2. **重複ファイル検出**
   - 同じファイルを複数回アップロード
   - "重複ファイル検出"メッセージが表示されることを確認
   - 新規アップロードが行われず、既存ファイルが使用されることを確認

## ショートカットキー操作

### キーボードショートカット

1. **S3接続テスト: Ctrl+Shift+T**

   - ショートカットキーでS3接続テストが実行されることを確認
   - 接続結果がポップアップで表示されることを確認

2. **S3ダウンロード: Ctrl+Shift+D**
   - S3添付ファイルを選択状態でショートカット実行
   - ダウンロード処理が開始されることを確認

## コマンドパレット操作

### プラグインコマンド

1. **ツール > S3 Upload Selected Attachments**

   - ローカル添付ファイルを選択
   - メニューからアップロードを実行
   - 選択されたファイルのみがアップロードされることを確認

2. **ツール > S3 Connection Test**

   - メニューから接続テストを実行
   - 現在の設定での接続状況が表示されることを確認

3. **ツール > S3 Settings**
   - メニューから設定画面が開くことを確認

### 登録されたプラグインコマンド

1. **S3 Upload Selected Attachments**

   - プラグインコマンドパレットから実行
   - 選択されたローカル添付ファイルがアップロードされることを確認

2. **S3 Download Selected S3 Attachments**

   - プラグインコマンドパレットから実行
   - 選択されたS3添付ファイルがダウンロードされることを確認

3. **S3 Connection Test**

   - プラグインコマンドパレットから実行
   - 接続テスト結果が表示されることを確認

4. **S3 Settings**
   - プラグインコマンドパレットから実行
   - 設定画面が開くことを確認

## エラーハンドリングとエッジケース

### ネットワークエラー

1. **ネットワーク切断時の動作**

   - インターネット接続を切断
   - アップロード/ダウンロードを試行
   - 適切なエラーメッセージが表示されることを確認
   - リトライ機能が動作することを確認

2. **認証エラー**
   - 無効な認証情報を設定
   - アップロード/ダウンロードを試行
   - 認証エラーメッセージが表示されることを確認

### ファイルサイズ制限

1. **大容量ファイル（>5MB）**

   - 大容量PDFファイルを追加
   - マルチパートアップロードが動作することを確認
   - プログレスバーが正しく表示されることを確認

2. **ファイル名に特殊文字**
   - 日本語、スペース、特殊文字を含むファイル名
   - 適切にサニタイズされてアップロードされることを確認
   - ダウンロード時に正しいファイル名で保存されることを確認

### 同期状況の確認

1. **S3ブラウザでの確認**

   - S3管理コンソールまたはサードパーティツールで
   - ファイルが正しくアップロードされていることを確認
   - メタデータ（Zotero item ID等）が正しく設定されていることを確認

2. **MD5ハッシュ検証**
   - アップロード前後でファイルのMD5ハッシュが一致することを確認
   - ダウンロード前後でファイルの内容が一致することを確認

## コレクション階層機能

### コレクション別保存

1. **設定でコレクション階層を有効化**

   - 設定画面で"コレクション階層を使用"にチェック
   - 設定を保存

2. **コレクション内でのファイル追加**

   - 特定のコレクション内でファイルを追加
   - S3キーがコレクション階層を反映していることを確認
   - 例: `collection1/subcollection/file.pdf`

3. **複数コレクション所属アイテム**
   - 複数のコレクションに所属するアイテムの添付ファイル
   - 適切なパスでアップロードされることを確認

## 削除機能

### ファイル削除の連携

1. **Zoteroアイテム削除**

   - S3添付ファイルを含むアイテムを削除
   - S3上のファイルも自動的に削除されることを確認

2. **ゴミ箱からの完全削除**

   - アイテムをゴミ箱に移動
   - ゴミ箱からアイテムを完全削除
   - S3上のファイルが削除されることを確認

3. **添付ファイルのみ削除**
   - 親アイテムは残し、添付ファイルのみ削除
   - S3上の対応ファイルが削除されることを確認

## マルチプロバイダー対応

### プロバイダー切り替え

1. **Amazon S3 → Cloudflare R2**

   - プロバイダーを切り替え
   - 新しいプロバイダーでファイルアップロードが正常に動作することを確認

2. **異なるリージョン設定**
   - S3の異なるリージョンでテスト
   - カスタムエンドポイント設定でテスト

## パフォーマンステスト

### 大量ファイル処理

1. **複数ファイル同時アップロード**

   - 10個以上のファイルを同時選択してアップロード
   - 並行処理が適切に動作することを確認
   - プログレス表示が正確であることを確認

2. **長時間動作テスト**
   - プラグインを長時間使用
   - メモリリークやパフォーマンス低下がないことを確認

## UI/UX確認

### プログレス表示

1. **アップロードプログレス**

   - プログレスウィンドウが適切なタイミングで表示される
   - パーセンテージが正確に更新される
   - 完了時に成功メッセージが表示される

2. **エラー通知**
   - 失敗時に分かりやすいエラーメッセージが表示される
   - エラー内容に応じた対処法が提示される

### メニュー表示

1. **コンテキストメニュー**
   - ローカル添付ファイル選択時："S3にアップロード"が表示
   - S3添付ファイル選択時："S3からダウンロード"が表示
   - 混在選択時：両方のメニューが適切に表示

## 国際化対応

### 多言語表示

1. **日本語環境**

   - すべてのメッセージが日本語で表示されることを確認

2. **英語環境**
   - Zoteroの言語設定を英語に変更
   - メッセージが英語で表示されることを確認

## バックアップとリストア

### データ移行

1. **設定のエクスポート/インポート**

   - プラグイン設定をバックアップ
   - 新しい環境で設定を復元
   - 正常に動作することを確認

2. **Zoteroデータベース移行**
   - S3添付ファイルを含むライブラリを別のZoteroに移行
   - S3リンクが正しく保持されることを確認
